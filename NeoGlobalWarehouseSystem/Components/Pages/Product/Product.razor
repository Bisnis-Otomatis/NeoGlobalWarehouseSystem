@page "/product"
@inject IDbContextFactory<ApplicationDbContext> ApplicationDbContextFactory
@inject ISnackbar Snackbar

<PageTitle>Product</PageTitle>

<MudContainer Class="mt-5">
    <MudButton StartIcon="@Icons.Material.Filled.Add" Variant="Variant.Filled" Color="Color.Primary" OnClick="() => NewProductExpanded = !NewProductExpanded" Disabled="NewProductExpanded == true">New Product</MudButton>
    <MudCollapse Expanded="NewProductExpanded" Class="py-2">
        <ProductEditor ButtonName="Add Product" ProcessedProduct="AddProduct" />
    </MudCollapse>

    <ProductsList />
</MudContainer>

@code {
    bool NewProductExpanded { get; set; } = false;

    public async Task AddProduct(Data.ApplicationDb.Product product)
    {
        await using var applicationDbContext = await ApplicationDbContextFactory.CreateDbContextAsync();
        await applicationDbContext.Products.AddAsync(product);
        await applicationDbContext.SaveChangesAsync();

        NewProductExpanded = false;
        Snackbar.Add("Product has been succesfully added", Severity.Success);
    }
}
